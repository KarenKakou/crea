if("undefined"==typeof jQuery)throw new Error("jQuery est requis pour Inea");!function(b){"use strict";function m(e,t){var a="ascending";e.data("tri")&&e.data("tri").colonne===t?(a="ascending"===e.data("tri").sens?"descending":"ascending",e.data("tri",{colonne:t,sens:a})):e.data("tri",{colonne:t,sens:"ascending"});for(var n=e.data("entetes"),i=0;i<n.length;i++){var r=n[i].entete;r.hasClass("tri")&&r.removeClass("ascending").removeClass("descending").removeAttr("aria-sort")}n[t].entete.addClass(a).attr("aria-sort",a),N(e)}function N(e){for(var t=e.data("entetes"),a=e.data("lignes"),n=[],i=0;i<a.length;i++){for(var r=!0,s=0;s<t.length;s++)if(t[s].filtre&&0!==t[s].filtre.selection&&a[i].valeurs[s]!==t[s].filtre.valeurs[t[s].filtre.selection]){r=!1;break}r&&n.push(a[i])}if(e.data("tri")){var l=e.data("tri").sens;s=e.data("tri").colonne;n.sort(function(e,t){var a=e.valeurs[s],n=t.valeurs[s];return isNaN(a)||isNaN(n)?"ascending"===l?a.localeCompare(n):n.localeCompare(a):"ascending"===l?a-n:n-a})}var o=0,d=n.length;if(e.data("pagination"))if(0===n.length)e.children("tfoot").find(".dgfipicon-page-premiere").parent().prop("disabled",!0),e.children("tfoot").find(".dgfipicon-page-precedente").parent().prop("disabled",!0),e.children("tfoot").find(".dgfipicon-page-suivante").parent().prop("disabled",!0),e.children("tfoot").find(".dgfipicon-page-derniere").parent().prop("disabled",!0),e.children("tfoot").find(".table-page").html(".. / ..");else{var p=e.data("pagination"),c=Math.ceil(n.length/p.lignes)-1;isNaN(p.page)&&("derniere"===p.page?p.page=c:p.page=0),p.page<0&&(p.page=0),p.page>c&&(p.page=c),o=p.page*p.lignes,d=p.lignes,e.children("tfoot").find(".dgfipicon-page-premiere").parent().prop("disabled",!1),e.children("tfoot").find(".dgfipicon-page-precedente").parent().prop("disabled",!1),e.children("tfoot").find(".dgfipicon-page-suivante").parent().prop("disabled",!1),e.children("tfoot").find(".dgfipicon-page-derniere").parent().prop("disabled",!1),0===p.page&&(e.children("tfoot").find(".dgfipicon-page-premiere").parent().prop("disabled",!0),e.children("tfoot").find(".dgfipicon-page-precedente").parent().prop("disabled",!0)),p.page===c&&(e.children("tfoot").find(".dgfipicon-page-suivante").parent().prop("disabled",!0),e.children("tfoot").find(".dgfipicon-page-derniere").parent().prop("disabled",!0)),e.children("tfoot").find(".table-page").attr("aria-label","page "+(p.page+1)+" sur "+(c+1)).html(p.page+1+" / "+(c+1))}var h="";for(i=o;i<o+d&&i<n.length;i++)h+=n[i].contenu;e.children("tbody").html(h)}b(window).on("load",function(){b(".table.table-inea").each(function(){var a=b(this);a.attr("role","grid"),a.children("thead").children("tr").eq(0).attr("role","row");var n=0;a.children("thead").children("tr").eq(0).children().each(function(){if(b(this).attr("colspan")&&!isNaN(b(this).attr("colspan"))){for(var e=parseInt(b(this).attr("colspan")),t=0;t<e;t++){a.children("thead").children("tr").eq(1).children().eq(n+t).attr("role","columnheader")}n+=e}else b(this).attr("role","columnheader")});var e=0;a.children("tbody").children("tr").each(function(){if(0<e)e-=1;else{b(this).attr("role","row");var t=0;b(this).children("th,td").each(function(){if(b(this).attr("rowspan")&&!isNaN(b(this).attr("rowspan"))){var e=parseInt(b(this).attr("rowspan"));t=Math.max(t,e)}}),0<t&&(e=t-1)}})}),b(".table.table-inea > thead > tr > th.tri:first-child").each(function(){b(this).attr("aria-sort","none")}),b(".table.table-inea").each(function(){var r=b(this),a=0,n=[],i=0,s=0;r.children("thead").children("tr").eq(0).children().each(function(){if(b(this).attr("colspan")&&!isNaN(b(this).attr("colspan"))){for(var e=parseInt(b(this).attr("colspan")),t=0;t<e;t++){var a=r.children("thead").children("tr").eq(1).children().eq(s+t);(a.hasClass("tri")||a.hasClass("filtre"))&&n.push({entete:a,cellule:i}),i+=1}s+=e}else(b(this).hasClass("tri")||b(this).hasClass("filtre"))&&n.push({entete:b(this),cellule:i}),i+=1});var l=[],o=0;r.children("tbody").children("tr").each(function(){if(0<o)l[l.length-1].contenu+=b(this).clone().wrap("<p/>").parent().html(),o-=1;else{var e={contenu:b(this).clone().wrap("<p/>").parent().html(),valeurs:[]},i=[],r=0;b(this).children("th,td").each(function(){var e=b(this).attr("data-filtre-tri")||b(this).html();if(b(this).attr("colspan")&&!isNaN(b(this).attr("colspan")))for(var t=parseInt(b(this).attr("colspan")),a=0;a<t;a++)i.push(e);else i.push(e);if(b(this).attr("rowspan")&&!isNaN(b(this).attr("rowspan"))){var n=parseInt(b(this).attr("rowspan"));r=Math.max(r,n)}}),a=i.length,0<r&&(o=r-1);for(var t=0;t<n.length;t++)e.valeurs.push(i[n[t].cellule]);l.push(e)}}),r.data("lignes",l);for(var e=0;e<n.length;e++){var t=n[e].entete;if(t.hasClass("filtre")){for(var d={},p=0;p<l.length;p++)d[l[p].valeurs[e]]=!0;var c=Object.keys(d);c.sort(function(e,t){return isNaN(e)||isNaN(t)?e.localeCompare(t):e-t});var h=t.attr("data-filtre-inactif")||"Tous";c.unshift(h),n[e].filtre={selection:0,valeurs:c}}var f="";if(t.hasClass("filtre"))f="<div>";if(t.hasClass("tri")?f+="<div><span>"+t.html()+'</span><button class="btn btn-table" title="Trier la colonne"><span class="glyphicon"></span></button></div>':f+="<div>"+t.html()+"</div>",t.hasClass("filtre")){f+="<select>";for(var g=0;g<n[e].filtre.valeurs.length;g++)f+='<option value="'+g+'"'+(0===g?" selected":"")+">"+n[e].filtre.valeurs[g]+"</option>";f+="</select></div>"}t.html(f),function(){var i=e;t.hasClass("tri")&&t.find("button").click(function(){m(r,i)}),t.hasClass("filtre")&&t.find("select").change(function(e){var t,a,n;t=r,a=i,n=parseInt(e.target.value),t.data("entetes")[a].filtre.selection=n,N(t)})}()}if(r.data("entetes",n),r.attr("data-pagination")){var u=isNaN(r.attr("data-pagination"))?10:parseInt(r.attr("data-pagination"));r.data("pagination",{lignes:u,page:0});var v='<tfoot class="table-pagination"><tr><td colspan="'+a+'"><div>';v+='<button class="btn btn-table" title="Première page"><span class="dgfipicon dgfipicon-page-premiere"></span></button>',v+='<button class="btn btn-table" title="Page précédente"><span class="dgfipicon dgfipicon-page-precedente"></span></button>',v+='<span class="table-page"></span>',v+='<button class="btn btn-table" title="Page suivante"><span class="dgfipicon dgfipicon-page-suivante"></span></button>',v+='<button class="btn btn-table" title="Dernière page"><span class="dgfipicon dgfipicon-page-derniere"></span></button>',v+="</td></tr></div></tfoot>",r.append(v),r.children("tfoot").find(".dgfipicon-page-premiere").parent().click(function(){r.data("pagination").page=0,N(r)}),r.children("tfoot").find(".dgfipicon-page-precedente").parent().click(function(){r.data("pagination").page-=1,N(r)}),r.children("tfoot").find(".dgfipicon-page-suivante").parent().click(function(){r.data("pagination").page+=1,N(r)}),r.children("tfoot").find(".dgfipicon-page-derniere").parent().click(function(){r.data("pagination").page="derniere",N(r)}),N(r)}})})}(jQuery);